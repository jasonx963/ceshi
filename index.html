<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iPhone 16 / Pro / Pro Max – Oferta</title>
  <meta name="description" content="iPhone 16 con estilo minimalista, selección de modelos y pago por transferencia.">

  <style>
    :root{
      --bg:#ffffff; --ink:#111111; --muted:#6e6e73; --hairline:#d2d2d7; --panel:#f5f5f7;
      --blue:#0077ff; --blue-ink:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink)}
    img{display:block;max-width:100%;height:auto}

    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.88);backdrop-filter:blur(8px);border-bottom:1px solid var(--hairline)}
    .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
    .brand{font-weight:800;letter-spacing:.2px}
    .btn-link{border:0;background:transparent;color:var(--ink);font-weight:700;cursor:pointer;padding:8px 10px;border-radius:10px}
    .btn-link:hover{background:#f2f2f2}
    .btn-blue{background:var(--blue);color:var(--blue-ink);border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
    .btn-blue:hover{filter:brightness(0.95)}

    .ticker{border-top:1px solid var(--hairline);border-bottom:1px solid var(--hairline);background:#fff}
    .ticker-inner{max-width:1200px;margin:0 auto;padding:8px 16px;white-space:nowrap;overflow:hidden}
    #tickerText{display:inline-block;will-change:transform;color:var(--muted);font-weight:700}

    .hero{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1.1fr .9fr;gap:28px;padding:28px 16px}
    @media(max-width:960px){.hero{grid-template-columns:1fr}}
    h1{font-size:clamp(28px,4vw,40px);line-height:1.15;margin:0 0 12px;font-weight:800;letter-spacing:.2px}
    .lead{color:var(--muted);margin:6px 0 18px}
    .panel{background:var(--panel);border:1px solid var(--hairline);border-radius:18px;padding:12px}
    .time{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .tchip{background:#000;color:#fff;display:inline-flex;align-items:center;justify-content:center;min-width:56px;height:48px;border-radius:12px;font-weight:900;font-size:22px}
    .colon{font-weight:900;font-size:22px}
    @media(max-width:420px){.tchip{min-width:46px;height:40px;font-size:18px}.colon{font-size:18px}}

    .hero-visual{border-radius:18px;border:1px solid var(--hairline);background:#fff;padding:10px;display:flex;align-items:center;justify-content:center;min-height:260px}
    .hero-visual img{object-fit:contain;max-height:360px}

    .section{max-width:1200px;margin:0 auto;padding:8px 16px 60px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media(max-width:1024px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}

    .card{background:#fff;border:1px solid var(--hairline);border-radius:18px;overflow:hidden;display:flex;flex-direction:column}
    .pimg{background:#fff;padding:16px;border-bottom:1px solid var(--hairline);display:flex;align-items:center;justify-content:center;aspect-ratio:1/1}
    .pimg img{object-fit:contain;max-height:360px}
    .content{padding:16px}
    .title{font-weight:800;margin:4px 0 8px;font-size:18px}
    .price{display:flex;align-items:flex-end;gap:10px;margin:8px 0}
    .price .new{font-size:28px;font-weight:900}
    .price .old{text-decoration:line-through;color:#8e8e93}
    .off{margin-left:auto;background:#000;color:#fff;border-radius:999px;padding:2px 10px;font-size:12px;font-weight:800}

    .opt-label{font-size:12px;color:var(--muted);font-weight:800;margin:10px 0 6px}
    .opt-row{display:flex;flex-wrap:wrap;gap:12px}

    /* —— 颜色圆点 —— */
    .swatch{
      width:44px;height:44px;border-radius:50%;
      border:2px solid var(--hairline);cursor:pointer;
      background:#fff center/cover no-repeat;display:inline-block;
      box-shadow:0 1px 1px rgba(0,0,0,.05) inset;
      transition:transform .12s ease,border-color .12s ease, box-shadow .12s ease;
    }
    .swatch:hover{transform:scale(1.04)}
    .swatch.active{outline:3px solid var(--blue);border-color:var(--blue)}
    .opt-hint{font-size:12px;color:#6e6e73;margin-top:4px;min-height:16px}

    /* 存储按键 */
    .opt-btn{background:#fff;border:1px solid var(--hairline);border-radius:999px;padding:6px 12px;font-weight:700;cursor:pointer}
    .opt-btn:hover{background:#f8f8f8}
    .opt-btn.active{background:#000;color:#fff;border-color:#000}

    .meta{display:flex;align-items:center;justify-content:space-between;color:#8e8e93;font-size:12px;margin-top:10px}
    .cta{margin-top:12px}
    .btn-cta{width:100%;background:var(--blue);color:#fff;font-weight:900;border:0;padding:12px 16px;border-radius:12px;cursor:pointer}
    .btn-cta:hover{filter:brightness(0.95)}

    .helpbar{position:sticky;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);border-top:1px solid var(--hairline);padding:10px 0}
    .helpbar-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 16px}
    .small{color:var(--muted);font-weight:700}

    .mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:80}
    .modal{background:#fff;border:1px solid var(--hairline);border-radius:16px;padding:18px;max-width:520px;width:92%}
    .modal h3{margin:0 0 8px}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px}
    .input{width:100%;padding:10px 12px;border:1px solid var(--hairline);border-radius:10px;font-size:14px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn.gray{background:#f3f3f3}
    .btn.primary{background:#000;color:#fff}

    .wa-fab{position:fixed;right:16px;bottom:16px;width:54px;height:54px;border-radius:50%;background:linear-gradient(180deg,#29d366,#21b954);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.25);z-index:70}
    .wa-fab img{width:30px;height:30px}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">Apple</div>
      <div>
        <button class="btn-link" id="btnCentro">Orden</button>
        <button class="btn-blue" id="btnTopWA">Contáctenos</button>
      </div>
    </div>
    <div class="ticker"><div class="ticker-inner"><span id="tickerText">Cargando últimas compras…</span></div></div>
  </header>

  <section class="hero">
    <div>
      <h1>iPhone 16 / Pro / Pro Max</h1>
      <p class="lead">Ahorra 85%. Envío desde Apple. Calidad garantizada.</p>
      <div class="panel">
        <div class="time">
          <div class="label" style="font-weight:800">Tiempo restante de la oferta</div>
          <div>
            <span class="tchip" id="d">00</span><span class="colon">:</span>
            <span class="tchip" id="h">00</span><span class="colon">:</span>
            <span class="tchip" id="m">00</span><span class="colon">:</span>
            <span class="tchip" id="s">00</span>
          </div>
          <div class="label" style="color:var(--muted)">Miles de usuarios están comprando</div>
        </div>
      </div>
    </div>
    <div class="hero-visual">
      <img src="images/16pro.png" alt="iPhone hero" loading="eager"
           onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop';">
    </div>
  </section>

  <section class="section">
    <div class="grid" id="grid"></div>
  </section>

  <div class="helpbar">
    <div class="helpbar-inner">
      <div class="small">¿Necesitas ayuda? Nuestro equipo está en línea.</div>
      <button class="btn-blue" id="btnBottomWA">Contactar por WhatsApp</button>
    </div>
  </div>

  <!-- Centro personal -->
  <div class="mask" id="modalMask">
    <div class="modal">
      <h3>Centro personal</h3>
      <p class="small">Ingresa tu <b>número de pedido</b> o <b>teléfono</b> para consultar el estado y envío.</p>
      <div class="row" style="margin-top:8px">
        <input class="input" id="q" placeholder="Ej.: ORD2025... / +52 1 55..." />
        <button class="btn primary" id="btnBuscar">Consultar</button>
      </div>
      <div style="margin-top:10px;display:flex;justify-content:flex-end;gap:8px">
        <button class="btn gray" id="btnCerrar">Cerrar</button>
      </div>
      <div id="resultBox" style="margin-top:10px"></div>
    </div>
  </div>

  <div class="wa-fab" id="waFab" title="WhatsApp">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
  </div>

  <script>
    // ===== 配置 =====
    const WHATSAPP_PHONE = 'https://lihi.vip/t4sPq';
    const FINISH_IN_MINUTES = 1440;
    const CURRENCY = 'MX$';
    const PAYMENT_URL = 'payment.html';

    // —— 产品数据（颜色与存储按你的要求） ——
    const productos = [
      {
        id: 'ip16',
        nombre: 'iPhone 16',
        precioOriginal: { '128GB': 19999, '256GB': 22499, '512GB': 27499 },
        descuento: 0.15,
        vendidos: 6473,
        opciones: {
          almacenamiento: ['128GB','256GB','512GB'],
          // 只显示色圆；点击后在 hint 展示名称
          colorSwatches: [
            {name:'Ultramarino',     img:'images/colors/16-ultramarino.jpeg'},
            {name:'Verde azulado',   img:'images/colors/16-verde-azulado.jpeg'},
            {name:'Rosa',            img:'images/colors/16-rosa.jpeg'},
            {name:'Blanco',          img:'images/colors/16-blanco.jpeg'},
            {name:'Negro',           img:'images/colors/16-negro.jpeg'}
          ]
        },
        img: 'images/16.png'
      },
      {
        id: 'ip16pro',
        nombre: 'iPhone 16 Pro',
        precioOriginal: { '128GB': 25999, '256GB': 28499, '512GB': 33499, '1TB': 38499 },
        descuento: 0.15,
        vendidos: 7941,
        opciones: {
          almacenamiento: ['128GB','256GB','512GB','1TB'],
          colorSwatches: [
            {name:'Titanio del desierto', img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23c6b096"/></svg>'},
            {name:'Titanio natural',      img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23cfcfd1"/></svg>'},
            {name:'Titanio blanco',       img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23f2f2f2"/></svg>'},
            {name:'Titanio negro',        img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23333333"/></svg>'}
          ]
        },
        img: 'images/16pro.png'
      },
      {
        id: 'ip16promax',
        nombre: 'iPhone 16 Pro Max',
        precioOriginal: { '256GB': 30999, '512GB': 35999, '1TB': 40999 },
        descuento: 0.15,
        vendidos: 8758,
        opciones: {
          almacenamiento: ['256GB','512GB','1TB'],
          colorSwatches: [
            {name:'Titanio del desierto', img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23c6b096"/></svg>'},
            {name:'Titanio natural',      img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23cfcfd1"/></svg>'},
            {name:'Titanio blanco',       img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23f2f2f2"/></svg>'},
            {name:'Titanio negro',        img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88"><circle cx="44" cy="44" r="44" fill="%23333333"/></svg>'}
          ]
        },
        img: 'images/16promax.png'
      }
    ];

    const grid = document.getElementById('grid');
    const money = n => CURRENCY + new Intl.NumberFormat('es-MX').format(Math.round(n));
    const seleccion = {};
    window.productos = productos;
    window.seleccion = seleccion;

    // 倒计时
    function getDeadline(){
      const key='pdd_iphone_deadline';
      const saved=localStorage.getItem(key);
      const now=Date.now();
      let deadline=saved?parseInt(saved,10):0;
      if(!deadline || deadline<now){
        deadline = now + FINISH_IN_MINUTES*60*1000;
        localStorage.setItem(key,String(deadline));
      }
      return deadline;
    }
    const two = n => String(n).padStart(2,'0');
    function tick(){
      const remain = Math.max(0, getDeadline()-Date.now());
      const totalSec = Math.floor(remain/1000);
      const d=Math.floor(totalSec/86400), h=Math.floor(totalSec%86400/3600), m=Math.floor(totalSec%3600/60), s=totalSec%60;
      document.getElementById('d').textContent=two(d);
      document.getElementById('h').textContent=two(h);
      document.getElementById('m').textContent=two(m);
      document.getElementById('s').textContent=two(s);
    }
    setInterval(tick,1000); tick();

    function updatePrice(cardId, storage){
      const p = productos.find(x=>x.id===cardId);
      if(!p || !storage) return;
      const original = p.precioOriginal[storage];
      const discount = Math.round(original * p.descuento);
      const card = grid.querySelector(`.card[data-id="${cardId}"]`);
      if(!card) return;
      card.querySelector('.price .new').textContent = money(discount);
      card.querySelector('.price .old').textContent = money(original);
    }

    function renderProductos(){
      grid.innerHTML = productos.map(p=>{
        const def = p.opciones.almacenamiento[0];
        const nuevo = Math.round(p.precioOriginal[def] * p.descuento);
        const offPct = Math.round((1 - p.descuento) * 100);
        const colorHintId = `hint-${p.id}`;
        return `
          <article class="card" data-id="${p.id}">
            <div class="pimg">
              <img loading="lazy" src="${p.img}" alt="${p.nombre}"
                   onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop';">
            </div>
            <div class="content">
              <div class="title">${p.nombre}</div>
              <div class="price">
                <div class="new">${money(nuevo)}</div>
                <div class="old">${money(p.precioOriginal[def])}</div>
                <span class="off">Ahorra ${offPct}%</span>
              </div>

              <div class="opt-label">Almacenamiento</div>
              <div class="opt-row">
                ${p.opciones.almacenamiento.map(opt=>`<button class="opt-btn" data-id="${p.id}" data-tipo="storage" data-valor="${opt}">${opt}</button>`).join('')}
              </div>

              <div class="opt-label">Color</div>
              <div class="opt-row">
                ${p.opciones.colorSwatches.map((c,i)=>`
                  <span class="swatch" title="${c.name}" data-id="${p.id}" data-tipo="color" data-valor="${c.name}" style="background-image:url('${c.img}')"></span>
                `).join('')}
              </div>
              <div id="${colorHintId}" class="opt-hint"></div>

              <div class="meta">
                <span>${p.vendidos.toLocaleString('es-MX')} compras</span>
                <span>Envío rápido</span>
              </div>

              <div class="cta">
                <button class="btn-cta" data-contact="${p.nombre}" data-product-id="${p.id}">Comprar</button>
              </div>
            </div>
          </article>
        `;
      }).join('');

      // 存储选择
      grid.querySelectorAll('.opt-btn').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const b=e.currentTarget, id=b.dataset.id, tipo=b.dataset.tipo, valor=b.dataset.valor;
          seleccion[id]=seleccion[id]||{};
          seleccion[id][tipo]=(seleccion[id][tipo]===valor)?null:valor;
          grid.querySelectorAll(`.opt-btn[data-id="${id}"][data-tipo="${tipo}"]`).forEach(x=>x.classList.remove('active'));
          if(seleccion[id][tipo]) grid.querySelector(`.opt-btn[data-id="${id}"][data-tipo="${tipo}"][data-valor="${valor}"]`).classList.add('active');
          if(tipo==='storage') updatePrice(id, valor);
        });
      });

      // 颜色选择（显示文字提示）
      grid.querySelectorAll('.swatch').forEach(s=>{
        s.addEventListener('click', e=>{
          const el=e.currentTarget, id=el.dataset.id, valor=el.dataset.valor;
          const card = el.closest('.card');
          const hint = card.querySelector(`#hint-${id}`);
          seleccion[id]=seleccion[id]||{};
          seleccion[id].color = (seleccion[id].color===valor) ? null : valor;
          card.querySelectorAll(`.swatch[data-id="${id}"]`).forEach(x=>x.classList.remove('active'));
          if(seleccion[id].color){ el.classList.add('active'); hint.textContent = `Color seleccionado: ${valor}`; }
          else{ hint.textContent = ''; }
        });
      });
    }
    renderProductos();

    // 支付页跳转
    (function(){
      document.addEventListener('click', function(e){
        const btn = e.target && e.target.closest && e.target.closest('button.btn-cta[data-product-id]');
        if(!btn) return;

        const productId   = btn.getAttribute('data-product-id') || '';
        const productName = btn.getAttribute('data-contact')    || '';
        const s = (window.seleccion && window.seleccion[productId]) || {};
        const productObj = (window.productos || []).find(p=>p.id===productId) || null;

        let storage = s.storage || '';
        let color   = s.color   || '';
        let price   = '';

        if(productObj){
          if(!storage && productObj.opciones?.almacenamiento?.length){
            storage = productObj.opciones.almacenamiento[0];
          }
          const original = productObj.precioOriginal?.[storage];
          if(typeof original === 'number'){
            price = Math.round(original * (typeof productObj.descuento==='number' ? productObj.descuento : 1));
          }
        }

        const picked = productName + (storage?(' '+storage):'') + (color?(' '+color):'');
        const params = new URLSearchParams({
          product:   picked,
          productId: productId,
          storage:   storage || '',
          color:     color   || '',
          price:     price   || ''
        });
        const url = `${PAYMENT_URL}?${params.toString()}`;

        e.preventDefault(); e.stopPropagation();
        if(typeof e.stopImmediatePropagation==='function') e.stopImmediatePropagation();
        const w = window.open(url,'_blank');
        if(w){ try{ w.opener = null; }catch(_){} }
      }, true);
    })();

    // 中心
    const modal = document.getElementById('modalMask');
    document.getElementById('btnCentro').onclick = ()=>{ modal.style.display='flex'; document.getElementById('q').focus(); };
    document.getElementById('btnCerrar').onclick = ()=>{ modal.style.display='none'; document.getElementById('resultBox').innerHTML=''; document.getElementById('q').value=''; };

    async function fetchOrders(q){
      try{
        if(!q) return [];
        let url = '/api/orders?';
        url += (q.startsWith('+') ? 'phone=' : 'orderId=') + encodeURIComponent(q);
        const r = await fetch(url, { cache:'no-store' });
        if(!r.ok) return [];
        return await r.json();
      }catch(_){ return []; }
    }
    document.getElementById('btnBuscar').onclick = async ()=>{
      const box = document.getElementById('resultBox');
      const q = (document.getElementById('q').value||'').trim();
      box.innerHTML = '<div class="small">Consultando…</div>';
      const list = await fetchOrders(q);
      if(!list || list.length===0){ box.innerHTML='<div class="small" style="color:#c00">No encontrado.</div>'; return; }
      box.innerHTML = list.map(o=>`
        <div style="background:#fafafa;border:1px solid var(--hairline);border-radius:12px;padding:10px;margin-top:10px">
          <div><b>Número de pedido:</b> ${o.orderId || '-'}</div>
          <div><b>Cliente:</b> ${o.name || '-'}</div>
          <div><b>Teléfono:</b> ${o.phone || '-'}</div>
          <div><b>Producto:</b> ${o.product || '-'} ${o.color?('('+o.color+')'):''} ×${o.qty||1}</div>
          <div><b>Precio:</b> ${o.price || '-'}</div>
          <div><b>Estado:</b> ${o.status || 'En proceso'}</div>
          <div><b>Transportista:</b> ${o.carrier || '-'}</div>
          <div><b>Número de envío:</b> ${o.tracking || '-'}</div>
          <div><b>Actualizado:</b> ${o.updatedAt || '-'}</div>
        </div>
      `).join('');
    };

    // 跑马灯
    (async function loadTicker(){
      try{
        const r = await fetch('/api/feed', { cache:'no-store' });
        const { ok, items } = await r.json();
        if(!ok || !items) return;
        const lines = items.map(o=>{
          const when = (o.updatedAt||'').slice(5,16).replace(' ',' ');
          return `【${when}】${o.name} compró ${o.product}${o.color?('('+o.color+')'):''} ×${o.qty}`;
        });
        const el = document.getElementById('tickerText');
        el.textContent = lines.join('　|　') || 'Reporte de compras recientes…';
        let off=0; setInterval(()=>{ off=(off+1)%50000; el.style.transform=`translateX(${-off}px)`; }, 30);
      }catch(_){}
    })();

    // WhatsApp
    function openWhatsApp(producto){
      const text = encodeURIComponent(`Hola, comuníquese con atención al cliente vía WhatsApp${producto?(' por '+producto):''}.`);
      window.open(`${WHATSAPP_PHONE}?text=${text}`, '_blank');
    }
    document.getElementById('btnTopWA').onclick = ()=>openWhatsApp('');
    document.getElementById('btnBottomWA').onclick = ()=>openWhatsApp('');
    document.getElementById('waFab').onclick = ()=>openWhatsApp('');
  </script>
</body>
</html>
