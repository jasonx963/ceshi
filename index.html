<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iPhone 16 / Pro / Pro Max – Hoy a mitad de precio</title>
  <meta name="description" content="iPhone 16 a mitad de precio, cantidad limitada, consulta de envíos, contacta a atención al cliente para comprar.">
  <style>
    :root{
      --red-600:#dc2626;--red-500:#ef4444;--red-400:#f87171;--yellow:#fde047;
      --ink:#7f1d1d;--muted:#9b1c1c;
      --whatsapp-green:#25D366;
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{background:linear-gradient(180deg,var(--red-600),var(--red-500) 50%,var(--red-400));color:#fff;min-height:100vh}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}

    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(6px);background:rgba(220,38,38,.88);border-bottom:1px solid rgba(255,255,255,.25)}
    header .bar{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:8px}
    .btn-white{background:#fff;color:var(--red-600);font-weight:800;border:0;border-radius:999px;padding:10px 14px;cursor:pointer}

    .ticker{overflow:hidden;white-space:nowrap;border-top:1px solid rgba(255,255,255,.35);border-bottom:1px solid rgba(255,255,255,.35);padding:8px 0;color:#ffe4e6;font-weight:800}
    #tickerText{display:inline-block;will-change:transform}

    .hero{display:grid;grid-template-columns:1fr;gap:24px;padding:24px 0}
    @media(min-width:900px){.hero{grid-template-columns:1fr 1fr;padding:40px 0}}
    h1{font-size:34px;line-height:1.1;margin:0 0 8px;font-weight:900}
    .h1-sub{color:var(--yellow)}
    .lead{opacity:.95;margin:8px 0 14px}
    .panel{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);padding:12px;border-radius:18px}

    .time{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .tchip{background:rgba(0,0,0,.35);padding:8px 10px;border-radius:8px;font-weight:900;font-size:18px;min-width:44px;text-align:center;line-height:1}

    .thumb{position:relative;border-radius:16px;overflow:hidden;aspect-ratio:4/3;background:#fee2e2;display:flex;align-items:center;justify-content:center}
    .thumb img{max-width:100%;max-height:100%;height:auto;object-fit:contain;display:block}

    .grid{display:grid;grid-template-columns:1fr;gap:16px;padding-bottom:140px}
    @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{background:#fff;color:var(--ink);border-radius:20px;box-shadow:0 12px 30px rgba(0,0,0,.22);overflow:hidden}
    .card .content{padding:16px}

    .pimg{aspect-ratio:1/1;border-radius:16px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
    .pimg img{max-width:100%;max-height:100%;height:auto;object-fit:contain;display:block}

    .title{margin:12px 0 8px;font-size:18px;font-weight:900}
    .price{display:flex;align-items:flex-end;gap:10px;margin:8px 0}
    .price .new{font-size:28px;font-weight:900}
    .price .old{text-decoration:line-through;opacity:.7;font-size:14px}
    .off{background:rgba(220,38,38,.08);color:var(--red-600);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:800}

    .opt-label{font-size:12px;font-weight:800;margin:8px 0 4px}
    .opt-row{display:flex;flex-wrap:wrap;gap:8px}
    .opt-btn{background:#fff;color:var(--ink);border:1px solid #fecaca;font-weight:700;font-size:13px;padding:6px 10px;border-radius:999px;cursor:pointer}
    .opt-btn.active{background:var(--red-600);color:#fff;border-color:var(--red-600)}

    .meta{display:flex;align-items:center;justify-content:space-between;font-size:11px;font-weight:800;color:#b91c1c;margin-top:8px}
    .bar{width:100%;height:8px;background:#fee2e2;border-radius:999px;overflow:hidden}
    .fill{height:100%;background:var(--red-600);width:30%}

    .btn-red{background:var(--whatsapp-green);color:#fff;font-weight:900;border:0;padding:12px 16px;border-radius:14px;cursor:pointer;width:100%}

    .stickybar-wrap{position:fixed;left:12px;right:12px;bottom:12px;z-index:60}
    .stickybar{background:#fff;color:var(--ink);border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.28);padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .tag{background:var(--red-600);color:#fff;font-weight:900;padding:6px 10px;border-radius:999px;font-size:12px}
    .small-btn{background:var(--whatsapp-green);color:#fff;font-weight:900;padding:10px 14px;border:0;border-radius:12px;cursor:pointer}

    .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:70}
    .modal{background:#fff;color:#111;border-radius:16px;max-width:520px;width:92%;padding:18px}
    .modal h3{margin:0 0 8px}
    .modal label{font-size:13px;font-weight:700}
    .modal input{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;margin-top:6px}
    .modal .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}.btn.gray{background:#eee}.btn.primary{background:#dc2626;color:#fff}

    .whatsapp-icon{position:fixed;top:50%;right:20px;transform:translateY(-50%);width:60px;height:60px;background:var(--whatsapp-green);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.2);cursor:pointer;z-index:100}
    .whatsapp-icon img{width:36px;height:36px}

    .flame{position:fixed;top:calc(50% + 70px);right:25px;width:50px;height:80px;background:radial-gradient(circle,#ff4500 0%,#ff8c00 50%,#800000 100%);clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);animation:burn .5s infinite alternate,flicker .3s infinite,sway 2s infinite ease-in-out;z-index:101}
    @keyframes burn{0%{background:radial-gradient(circle,#ff4500 0%,#ff8c00 50%,#800000 100%)}100%{background:radial-gradient(circle,#ff8c00 0%,#ff4500 50%,#800000 100%)}}
    @keyframes flicker{0%{opacity:.9}100%{opacity:1}}
    @keyframes sway{0%{transform:translateX(0) rotate(0)}25%{transform:translateX(-5px) rotate(5deg)}75%{transform:translateX(5px) rotate(-5deg)}100%{transform:translateX(0) rotate(0)}}

    .countdown-label{position:fixed;top:calc(50% + 140px);right:10px;color:var(--red-600);font-size:16px;font-weight:700;text-align:center;z-index:99}
    .countdown-container{position:fixed;top:calc(50% + 180px);right:10px;display:flex;justify-content:center;align-items:center;gap:4px;z-index:99}
    .countdown-digit{background:rgba(0,0,0,.35);padding:8px 10px;border-radius:8px;font-weight:900;font-size:18px;min-width:44px;text-align:center;line-height:1;color:var(--whatsapp-green)}
  </style>
  <!-- Meta Pixel（可留） -->
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}
  (window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init','778576598009530');fbq('track','PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=778576598009530&ev=PageView&noscript=1"/></noscript>
</head>
<body>
  <header>
    <div class="container bar">
      <div class="brand"><div style="font-size:20px;font-weight:900">KAI BO</div></div>
      <div style="display:flex;gap:8px">
        <button class="btn-white" id="btnCentro">Orden</button>
        <button class="btn-white" id="btnTopWA">Contáctenos</button>
      </div>
    </div>
    <div class="container ticker"><span id="tickerText">Cargando últimas compras…</span></div>
  </header>

  <main class="container">
    <section class="hero">
      <div>
        <h1>iPhone 16 / Pro / Pro Max<br><span class="h1-sub">El iPhone 16 está a mitad de precio hoy, ¡cómpralo ya!</span></h1>
        <p class="lead">Producto original | Envío rápido | Consulta de envíos</p>
        <div class="panel">
          <div class="time">
            <div style="font-weight:800">Tiempo restante de la oferta</div>
            <div class="timer-container">
              <span class="tchip" id="d">00</span><span>:</span>
              <span class="tchip" id="h">00</span><span>:</span>
              <span class="tchip" id="m">00</span><span>:</span>
              <span class="tchip" id="s">00</span>
            </div>
            <div style="font-size:12px;opacity:.95;font-weight:800">Miles de usuarios están comprando</div>
          </div>
        </div>
      </div>
      <div class="thumb">
        <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop" alt="iPhone promo"/>
      </div>
    </section>

    <section class="grid" id="grid"></section>
  </main>

  <div class="stickybar-wrap">
    <div class="container">
      <div class="stickybar">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="tag">Oferta relámpago</span>
          <div id="bottomTimer" style="font-weight:900;font-size:14px;">Restante 00:00:00</div>
        </div>
        <button class="small-btn" id="btnBottomWA">Contactar atención al cliente</button>
      </div>
    </div>
  </div>

  <!-- 个人中心 Modal（简单占位） -->
  <div class="modal-mask" id="modalMask">
    <div class="modal">
      <h3>Centro personal</h3>
      <p style="margin:0 0 8px;color:#444">Ingresa tu <b>número de pedido</b> o <b>teléfono</b> para consultar el estado y envío.</p>
      <label for="q">Número de pedido / Teléfono</label>
      <input id="q" placeholder="Ejemplo: ORD2025... / +52 1 55..." />
      <div class="actions">
        <button class="btn gray" id="btnCerrar">Cerrar</button>
        <button class="btn primary" id="btnBuscar">Consultar</button>
      </div>
      <div id="resultBox"></div>
    </div>
  </div>

  <div class="whatsapp-icon" id="whatsappIcon">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" />
  </div>

  <div class="flame" id="flame"></div>
  <div class="countdown-label">Cuenta atrás</div>
  <div class="countdown-container" id="countdown-container">
    <span class="countdown-digit" id="seconds">30</span>
  </div>

  <script>
    // ===== 配置 =====
    const WHATSAPP_PHONE = 'https://lihi.vip/t4sPq';
    const FINISH_IN_MINUTES = 1440;
    const CURRENCY = 'MX$';
    const PAYMENT_URL = 'payment.html';

    // 自托管图片（/images/）
    const productos = [
      { 
        id: 'ip16',
        nombre: 'iPhone 16',
        precioOriginal: { '128GB': 19999, '256GB': 22499, '512GB': 27499 },
        descuento: 0.15, // 15% 折扣
        vendidos: 6473,
        opciones: { almacenamiento: ['128GB','256GB','512GB'], color: ['Negro','Blanco','Azul'] },
        img: '/images/16.png'
      },
      { 
        id: 'ip16pro',
        nombre: 'iPhone 16 Pro',
        precioOriginal: { '128GB': 25999, '256GB': 28499, '512GB': 33499, '1TB': 38499 },
        descuento: 0.15,
        vendidos: 7941,
        opciones: { almacenamiento: ['128GB','256GB','512GB','1TB'], color: ['Negro','Blanco','Dorado','Azul'] },
        img: '/images/16pro.png'
      },
      { 
        id: 'ip16promax',
        nombre: 'iPhone 16 Pro Max',
        precioOriginal: { '256GB': 30999, '512GB': 35999, '1TB': 40999 },
        descuento: 0.15,
        vendidos: 8758,
        opciones: { almacenamiento: ['256GB','512GB','1TB'], color: ['Negro','Blanco','Dorado','Azul','Rojo'] },
        img: '/images/16promax.png'
      }
    ];

    // WhatsApp
    function openWhatsApp(producto){
      const text = encodeURIComponent(`Hola, comuníquese con atención al cliente vía WhatsApp para reclamar su iPhone a mitad de precio${producto?(' de '+producto):''}.`);
      window.open(`${WHATSAPP_PHONE}?text=${text}`,'_blank');
    }
    document.getElementById('btnTopWA').onclick = () => openWhatsApp('');
    document.getElementById('btnBottomWA').onclick = () => openWhatsApp('');
    document.getElementById('whatsappIcon').onclick = () => openWhatsApp('');

    // 倒计时
    function getDeadline(){
      const key='pdd_iphone_deadline'; const saved=localStorage.getItem(key); const now=Date.now();
      let deadline=saved?parseInt(saved,10):0;
      if(!deadline || deadline < now){ deadline = now + FINISH_IN_MINUTES*60*1000; localStorage.setItem(key,String(deadline)); }
      return deadline;
    }
    const two = n => String(n).padStart(2,'0');
    function tick(){
      const remain = Math.max(0, getDeadline()-Date.now());
      const totalSec = Math.floor(remain/1000);
      const d=Math.floor(totalSec/86400), h=Math.floor(totalSec%86400/3600), m=Math.floor(totalSec%3600/60), s=totalSec%60;
      document.getElementById('d').textContent=two(d);
      document.getElementById('h').textContent=two(h);
      document.getElementById('m').textContent=two(m);
      document.getElementById('s').textContent=two(s);
      document.getElementById('bottomTimer').textContent=`Restante ${two(h)}:${two(m)}:${two(s)}`;
    }
    setInterval(tick,1000); tick();

    // 商品渲染
    const grid = document.getElementById('grid');
    const seleccion = {}; // 用户选择
    const money = n => CURRENCY + Math.round(n);

    function updatePrice(cardId, storage){
      const product = productos.find(p => p.id === cardId);
      if(!product || !storage) return;
      const priceOriginal = product.precioOriginal[storage];
      const priceDiscounted = Math.round(priceOriginal * product.descuento);
      const card = grid.querySelector(`.card[data-id="${cardId}"]`);
      if(card){
        const priceNew = card.querySelector('.price .new');
        const priceOld = card.querySelector('.price .old');
        if(priceNew && priceOld){
          priceNew.textContent = money(priceDiscounted);
          priceOld.textContent = money(priceOriginal);
        }
      }
    }

    function renderProductos(){
      grid.innerHTML = productos.map(p=>{
        const defaultStorage = p.opciones.almacenamiento[0];
        const nuevo = Math.round(p.precioOriginal[defaultStorage] * p.descuento);
        const prog = Math.min(100, (p.vendidos % 1000) / 10);
        return `
          <article class="card" data-id="${p.id}">
            <div class="content">
              <div class="pimg"><img loading="lazy" src="${p.img}" alt="${p.nombre}"></div>
              <div class="title">${p.nombre}</div>
              <div class="price">
                <div class="new">${money(nuevo)}</div>
                <div class="old">${money(p.precioOriginal[defaultStorage])}</div>
                <span class="off">Descuento -15%</span>
              </div>

              <div class="opt-label">Almacenamiento</div>
              <div class="opt-row">
                ${p.opciones.almacenamiento.map(opt=>`<button class="opt-btn" data-id="${p.id}" data-tipo="storage" data-valor="${opt}">${opt}</button>`).join('')}
              </div>

              <div class="opt-label">Color</div>
              <div class="opt-row">
                ${p.opciones.color.map(opt=>`<button class="opt-btn" data-id="${p.id}" data-tipo="color" data-valor="${opt}">${opt}</button>`).join('')}
              </div>

              <div class="meta">
                <span>${p.vendidos.toLocaleString()} personas compraron</span>
                <span>Envío inmediato</span>
              </div>
              <div class="bar"><div class="fill" style="width:${prog}%"></div></div>

              <div style="margin-top:12px">
                <button class="btn-red" data-contact="${p.nombre}" data-product-id="${p.id}">Haz tu pedido y compra</button>
              </div>
            </div>
          </article>`;
      }).join('');

      // 规格选择
      grid.querySelectorAll('.opt-btn').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const b = e.currentTarget, id=b.dataset.id, tipo=b.dataset.tipo, valor=b.dataset.valor;
          seleccion[id] = seleccion[id] || {};
          seleccion[id][tipo] = (seleccion[id][tipo] === valor) ? null : valor;
          grid.querySelectorAll(`.opt-btn[data-id="${id}"][data-tipo="${tipo}"]`).forEach(x=>x.classList.remove('active'));
          if(seleccion[id][tipo]) grid.querySelector(`.opt-btn[data-id="${id}"][data-tipo="${tipo}"][data-valor="${valor}"]`).classList.add('active');
          if(tipo==='storage') updatePrice(id, valor);
        });
      });
    }
    renderProductos();

    // 简易“个人中心”开关（如需对接 /api/orders 可自行扩展）
    document.getElementById('btnCentro').onclick = ()=>{
      document.getElementById('modalMask').style.display='flex';
      document.getElementById('q').focus();
    }
    document.getElementById('btnCerrar')?.addEventListener('click',()=>{
      document.getElementById('modalMask').style.display='none';
      document.getElementById('resultBox').innerHTML='';
      document.getElementById('q').value='';
    });

    // 跑马灯（无后端时静默）
    (async function loadTicker(){
      try{
        const res = await fetch('/api/feed',{cache:'no-store'});
        const {ok,items} = await res.json();
        if(!ok || !items) return;
        const lines = items.map(o=>{
          const when=(o.updatedAt||'').slice(5,16).replace(' ',' ');
          return `【${when}】${o.name} compró ${o.product}${o.color?('('+o.color+')'):''} ×${o.qty}`;
        });
        const text = lines.join('　|　');
        const el = document.getElementById('tickerText');
        el.textContent = text || 'Reporte de compras recientes…';
        let off=0; setInterval(()=>{off=(off+1)%50000; el.style.transform=`translateX(${-off}px)`},30);
      }catch(e){}
    })();

    // 右侧 30s 演示倒计时
    let countdownTime = 30;
    function updateCountdown(){
      document.getElementById('seconds').textContent = countdownTime;
      countdownTime = countdownTime<=0 ? 30 : countdownTime-1;
      setTimeout(updateCountdown,1000);
    }
    window.onload = updateCountdown;
  </script>

  <!-- 统一拦截购买按钮：新开支付页 + 传型号/颜色/价格，且不让当前页跳走 -->
  <script>
  (function(){
    document.addEventListener('click', function(e){
      const btn = e.target && e.target.closest && e.target.closest('button.btn-red[data-product-id]');
      if(!btn) return;

      const productId   = btn.getAttribute('data-product-id') || '';
      const productName = btn.getAttribute('data-contact')    || '';

      const s = (window.seleccion && window.seleccion[productId]) || {};
      const productObj = (window.productos || []).find(p=>p.id===productId) || null;

      let storage = s.storage || '';
      let color   = s.color   || '';
      let price   = '';

      if(productObj){
        if(!storage && productObj.opciones && productObj.opciones.almacenamiento?.length){
          storage = productObj.opciones.almacenamiento[0]; // 默认存储
        }
        const priceOriginal = productObj.precioOriginal && productObj.precioOriginal[storage];
        if(typeof priceOriginal === 'number'){
          price = Math.round(priceOriginal * (typeof productObj.descuento==='number' ? productObj.descuento : 1));
        }
      }

      const picked = productName + (storage?(' '+storage):'') + (color?(' '+color):'');
      const params = new URLSearchParams({
        product:   picked,
        productId: productId,
        storage:   storage || '',
        color:     color   || '',
        price:     price   || ''
      });

      const url = `${PAYMENT_URL}?${params.toString()}`;

      e.preventDefault();
      e.stopPropagation();
      if(typeof e.stopImmediatePropagation === 'function') e.stopImmediatePropagation();

      const w = window.open(url,'_blank');
      if(w){ try{ w.opener = null; }catch(_){} }
    }, true); // 捕获阶段
  })();
  </script>
</body>
</html>
